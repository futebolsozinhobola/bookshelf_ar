<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca do Conhecimento AR</title>
    <!-- Importação da biblioteca A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- Importação da biblioteca AR.js para A-Frame -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <!-- A-Frame Scene -->
    <!-- ATUALIZAÇÃO: Adicionamos parâmetros ao 'arjs' para solicitar uma resolução maior da câmera -->
    <!-- Isso melhora a qualidade da imagem, mas pode impactar o desempenho em celulares mais antigos -->
    <a-scene embedded arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960;'>
        <a-assets>
            <a-asset-item id="bookshelf" src="assets/estante.glb"></a-asset-item>
        </a-assets>

        <a-marker type="pattern" url="assets/marcador.patt">
            <!-- Modelo 3D Interativo -->
            <!-- ATUALIZAÇÃO: Aumentamos a 'scale' para o modelo parecer maior -->
            <!-- e ajustamos a posição 'y' para que ele continue 'sentado' no marcador -->
            <a-gltf-model
                id="modelo"
                src="#bookshelf"
                position="0 0.75 0"
                scale="0.25 0.25 0.25"
                rotation="-90 0 0"
            ></a-gltf-model>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <!-- Script para Interação (Rotação com Drag) -->
    <script>
        window.addEventListener('load', () => {
            const model = document.querySelector('#modelo');
            const scene = document.querySelector('a-scene');
            
            let isDragging = false;
            let previousClientX = 0;
            let previousClientY = 0;

            // Função para iniciar o arraste (mouse ou toque)
            const startDrag = (event) => {
                isDragging = true;
                const touch = event.touches ? event.touches[0] : event;
                previousClientX = touch.clientX;
                previousClientY = touch.clientY;
            };

            // Função para mover o modelo durante o arraste
            const drag = (event) => {
                if (!isDragging) return;

                event.preventDefault(); // Previne o scroll da página no celular
                const touch = event.touches ? event.touches[0] : event;
                const deltaX = touch.clientX - previousClientX;
                
                // A rotação atual do modelo
                const currentRotation = model.getAttribute('rotation');
                
                // Atualiza a rotação no eixo Y (rotação horizontal)
                // O valor 0.5 é um fator de sensibilidade, ajuste se necessário
                model.setAttribute('rotation', {
                    x: currentRotation.x,
                    y: currentRotation.y + deltaX * 0.5,
                    z: currentRotation.z
                });

                previousClientX = touch.clientX;
                previousClientY = touch.clientY;
            };

            // Função para terminar o arraste
            const endDrag = () => {
                isDragging = false;
            };

            // Adiciona os event listeners para mouse
            scene.addEventListener('mousedown', startDrag);
            scene.addEventListener('mousemove', drag);
            scene.addEventListener('mouseup', endDrag);
            scene.addEventListener('mouseleave', endDrag);

            // Adiciona os event listeners para toque (celular)
            scene.addEventListener('touchstart', startDrag);
            scene.addEventListener('touchmove', drag);
            scene.addEventListener('touchend', endDrag);
        });
    </script>
</body>
</html>
