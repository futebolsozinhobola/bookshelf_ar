<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca do Conhecimento AR</title>
    <!-- Importação da biblioteca A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- Importação da biblioteca AR.js para A-Frame -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <!-- A-Frame Scene -->
    <!-- CORREÇÃO: Simplificamos a configuração do arjs para maior compatibilidade. -->
    <a-scene embedded arjs>

        <!-- CORREÇÃO: Adicionamos luzes à cena. Sem luz, o modelo 3D fica preto e invisível. -->
        <!-- Luz Ambiente: Ilumina todas as partes do modelo igualmente. -->
        <a-light type="ambient" color="#888"></a-light>
        <!-- Luz Direcional: Simula uma fonte de luz como o sol, criando realces e sombras. -->
        <a-light type="directional" color="#FFF" intensity="0.8" position="-1 1 2"></a-light>

        <a-assets>
            <a-asset-item id="bookshelf" src="assets/estante.glb"></a-asset-item>
        </a-assets>

        <a-marker type="pattern" url="assets/marcador.patt">
            <a-gltf-model
                id="modelo"
                src="#bookshelf"
                position="0 0.75 0"
                scale="1 1 1"
                rotation="-90 0 0"
            ></a-gltf-model>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <!-- Script para Interação (Rotação com Drag) -->
    <script>
        window.addEventListener('load', () => {
            const model = document.querySelector('#modelo');
            const scene = document.querySelector('a-scene');
            
            let isDragging = false;
            let previousClientX = 0;
            let previousClientY = 0;

            const startDrag = (event) => {
                isDragging = true;
                const touch = event.touches ? event.touches[0] : event;
                previousClientX = touch.clientX;
                previousClientY = touch.clientY;
            };

            const drag = (event) => {
                if (!isDragging) return;
                event.preventDefault();
                const touch = event.touches ? event.touches[0] : event;
                const deltaX = touch.clientX - previousClientX;
                
                const currentRotation = model.getAttribute('rotation');
                
                model.setAttribute('rotation', {
                    x: currentRotation.x,
                    y: currentRotation.y + deltaX * 0.5,
                    z: currentRotation.z
                });

                previousClientX = touch.clientX;
                previousClientY = touch.clientY;
            };

            const endDrag = () => {
                isDragging = false;
            };

            scene.addEventListener('mousedown', startDrag);
            scene.addEventListener('mousemove', drag);
            scene.addEventListener('mouseup', endDrag);
            scene.addEventListener('mouseleave', endDrag);

            scene.addEventListener('touchstart', startDrag);
            scene.addEventListener('touchmove', drag);
            scene.addEventListener('touchend', endDrag);
        });
    </script>
</body>
</html>
